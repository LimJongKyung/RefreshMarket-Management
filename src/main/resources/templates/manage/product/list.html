<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" class="h-100" data-bs-theme="auto" >
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<th:block th:insert="~{template/fragments/block :: config}"></th:block>
<link href="/css/main.css" rel="stylesheet">
<link href="/css/productCSS/listP.css" rel="stylesheet">
</head>
<body>
	<th:block th:insert="~{template/fragments/block :: header}"></th:block>
	<th:block th:insert="~{template/fragments/block :: logo}"></th:block>
    <th:block th:insert="~{template/fragments/block :: mainMenu}"></th:block>
    <div class="layout-container">
	    <th:block th:insert="~{template/fragments/block :: sideMenu}"></th:block>
	    <!-- 본문 영역 -->
	    <main class="product">
		  <div class="product-list">
		    <h2>상품 목록</h2>
		    
		    <!-- 검색 폼 -->
		    <form action="/product" method="get">
		      <select name="searchType">
		        <option value="name" th:selected="${searchType} == 'name'">제품명</option>
		        <option value="description" th:selected="${searchType} == 'description'">설명</option>
		        <option value="category" th:selected="${searchType} == 'category'">카테고리</option>
		      </select>
		      <input type="text" name="keyword" placeholder="검색어 입력" th:value="${keyword}">
		      <button type="submit">검색</button>
		    </form>
		
		    <!-- 상품 테이블 -->
		    <table border="1">
		      <thead>
		        <tr>
		          <th>번호</th>
		          <th>이미지</th>
		          <th>제품명</th>
		          <th>설명</th>
		          <th>가격</th>
		          <th>재고</th>
		          <th>카테고리</th>
		          <th>등록일</th>
		          <th>수정일</th>
		        </tr>
		      </thead>
		      <tbody>
		        <tr th:each="product, stat : ${productPage.content}">
		          <td th:text="${stat.index + 1 + (productPage.number * productPage.size)}"></td>
		          <td>
		            <img th:src="@{/product/image/{id}(id=${product.productId})}" alt="이미지" style="width:80px; height:80px; object-fit:cover;" />
		          </td>
		          <td>
		            <a th:href="@{'/product/' + ${product.productId}}" th:text="${product.name}"></a>
		          </td>
		          <td th:text="${product.description}"></td>
		          <td th:text="${#numbers.formatDecimal(product.price, 1, 'COMMA', 2, 'POINT')} + '원'"></td>
		          <td th:text="${product.stock}"></td>
		          <td th:text="${product.category}">카테고리</td>
		          <td th:text="${#temporals.format(product.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
		          <td th:text="${#temporals.format(product.updatedAt, 'yyyy-MM-dd HH:mm')}"></td>
		        </tr>
		      </tbody>
		    </table>
		    <br/>
			<a href="/product/new" class="btn btn-primary">상품 등록</a>
			<br/>
		    <!-- 검색 결과 없음 -->
		    <div th:if="${searchTried} and ${productPage.totalElements == 0}">
		      <p style="color: red;">검색한 조건의 상품이 없습니다.</p>
		    </div>
		  </div>
			
		  <!-- 페이지네이션 -->
		  <div class="pagination">
		    <a th:if="${productPage.hasPrevious()}" th:href="@{/product(page=${currentPage - 1})}">이전</a>
		
		    <span th:each="i : ${#numbers.sequence(0, productPage.totalPages - 1)}">
		      <a th:href="@{/product(page=${i})}"
		         th:text="${i + 1}"
		         th:classappend="${i == currentPage} ? 'active' : ''"></a>
		    </span>
		
		    <a th:if="${productPage.hasNext()}" th:href="@{/product(page=${currentPage + 1})}">다음</a>
		  </div>
		</main>
	 </div>
	<th:block th:insert="~{template/fragments/block :: footer}"></th:block>
	<script src="/JS/modifyC.js"></script>
</body>
</html>